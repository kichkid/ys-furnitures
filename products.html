<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YS Nation Furnitures Collections</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #e67e22;
      --accent: #f1c40f;
      --light: #ecf0f1;
      --dark: #34495e;
    }
    
    body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
    .card { border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: 0.3s; }
    .card:hover { transform: translateY(-5px); }
    .category-buttons button { margin: 5px; }
    #cartModal .modal-body { max-height: 400px; overflow-y: auto; }
    .price { font-weight: bold; color: #198754; }
    .discount { color: #dc3545; font-size: 0.9rem; }
    .heading { text-align: center; margin-bottom: 15px; }
    .heading h1 { font-weight: bold; }
    .heading h5 { color: #6c757d; }
    .cart-btn { position: relative; }
    .cart-btn span { position: absolute; top: -10px; right: -10px; background: red; color: #fff; font-size: 12px; border-radius: 50%; padding: 3px 7px; }
    .product img { height: 180px; object-fit: cover; border-radius: 10px; }

    /* Footer */
    footer { 
      background: #2c3e50; 
      color: #fff; 
      padding: 50px 0 20px; 
      margin-top: 60px; 
    }
    
    .footer-title {
      font-size: 1.2rem;
      margin-bottom: 20px;
      font-weight: 600;
      position: relative;
      padding-bottom: 10px;
    }
    
    .footer-title:after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 40px;
      height: 3px;
      background: var(--secondary);
    }
    
    .footer a {
      color: #ddd;
      text-decoration: none;
      transition: color 0.3s;
      display: block;
      margin-bottom: 8px;
    }
    
    .footer a:hover {
      color: var(--accent);
    }
    
    .social-icons {
      margin-top: 20px;
      text-align: center;
    }
    
    .social-icons a {
      display: inline-block;
      width: 40px;
      height: 40px;
      line-height: 40px;
      text-align: center;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      margin: 0 5px;
      transition: all 0.3s;
    }
    
    .social-icons a:hover {
      background: var(--secondary);
      transform: translateY(-3px);
    }
    
    .footer-divider {
      border-color: rgba(255,255,255,0.1);
      margin: 30px 0;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      background: #25D366;
      color: white;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transform: translateX(100%);
      transition: transform 0.3s ease-out;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 80%;
    }
    
    .notification.error {
      background: #ff4d4d;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Mobile specific styles */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .category-buttons {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 10px;
      }
      
      .notification {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
      }
    }
  </style>
</head>
<body>
  <header class="sliding-header">
    <div class="header-content">
      <div class="logo">YS Nations Furniture</div>
      <div class="logo">Got-You</div>
      <div class="logo">Covered</div>
      <div class="logo">Nation Wide</div>
    </div>
  </header>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-smpy-3 position-sticky top-0">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="images/logo.png" alt="YS Furniture Logo" width="40" height="40" class="me-2">
        <span class="fw-bold">YS Furniture</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="index.html"><i class="fas fa-home"></i> Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="products.html"><i class="fas fa-th"></i> View Our Products</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html"><i class="fas fa-info-circle"></i> About Us</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-4 mt-5 pt-5">
    <div class="heading">
      <h1><i class="fa-solid fa-couch"></i> YS Nation Furnitures Collections</h1>
      <h5>✨ Enjoy Our Discount Prices ✨</h5>
    </div>

    <!-- Category Buttons -->
    <div class="text-center category-buttons mb-4">
      <button class="btn btn-outline-dark filter-btn" data-category="all"><i class="fa-solid fa-border-all"></i> All</button>
      <button class="btn btn-outline-dark filter-btn" data-category="wine"><i class="fa-solid fa-wine-bottle"></i> Wine Shelves</button>
      <button class="btn btn-outline-dark filter-btn" data-category="dining"><i class="fa-solid fa-utensils"></i> Dining Sets</button>
      <button class="btn btn-outline-dark filter-btn" data-category="chairs"><i class="fa-solid fa-chair"></i> Luxury Chairs</button>
      <button class="btn btn-outline-dark filter-btn" data-category="kitchen"><i class="fa-solid fa-kitchen-set"></i> Kitchen Cabinets</button>
      <button class="btn btn-outline-dark filter-btn" data-category="doors"><i class="fa-solid fa-door-closed"></i> Doors</button>
      <button class="btn btn-outline-dark filter-btn" data-category="bed"><i class="fa-solid fa-bed"></i> Beds</button>
      <button class="btn btn-outline-dark filter-btn" data-category="tv"><i class="fa-solid fa-tv"></i> TV Consoles</button>
    </div>

    <!-- Cart Button -->
    <div class="text-end mb-3">
      <button class="btn btn-primary cart-btn" data-bs-toggle="modal" data-bs-target="#cartModal">
        <i class="fa-solid fa-cart-shopping "></i> View Cart 
        <span id="cartCount">0</span>
      </button>
      <button id="clearCartBtn" class="btn btn-outline-danger ms-2">
        <i class="fas fa-trash"></i> Clear Cart
      </button>
    </div>

    <!-- Products -->
    <div class="row" id="products"></div>
  </div>

  <!-- Cart Modal -->
  <div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-cart-shopping"></i> Your Cart</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ul id="cartItems" class="list-group mb-3"></ul>
          <div class="d-flex justify-content-between mb-3">
            <h5>Total: <span id="cartTotal">₦0</span></h5>
          </div>

          <h5><i class="fa-solid fa-user"></i> Customer Info</h5>
          <form id="orderForm">
            <input type="text" id="fullName" class="form-control mb-2" placeholder="Full Name" required>
            <input type="text" id="phone" class="form-control mb-2" placeholder="Phone Number" required>
            <textarea id="address" class="form-control mb-2" placeholder="Address" required></textarea>
            <button type="submit" class="btn btn-success w-100"><i class="fa-brands fa-whatsapp"></i> Submit Order via WhatsApp</button>
          </form>

          <!-- Manual WhatsApp option for mobile -->
          <!--<div class="mt-4 p-3 border rounded">
            <h6><i class="fas fa-mobile-alt me-2"></i> Mobile Troubleshooting</h6>
            <p class="small mb-2">If the automatic redirect doesn't work:</p>
            <div class="d-flex align-items-center">
              <input type="text" id="manualWhatsappNumber" class="form-control form-control-sm me-2" value="2347026972403" readonly>
              <button id="copyButton" class="btn btn-sm btn-outline-primary"><i class="far fa-copy"></i> Copy</button>
            </div>
            <p class="small mt-2">Copy this number and manually message us on WhatsApp with your order details.</p>
          </div>-->
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container py-5">
      <div class="row">
        <div class="col-md-3 col-sm-6 mb-4">
          <h5 class="footer-title"><i class="fas fa-phone-alt me-2"></i> Contact Us</h5>
          <p><i class="fas fa-phone me-2"></i> +234 701 234 5678</p>
          <p><i class="fab fa-whatsapp me-2"></i> 
            <a href="https://wa.me/2347012345678" target="_blank">Chat with us</a>
          </p>
        </div>
  
        <div class="col-md-3 col-sm-6 mb-4">
          <h5 class="footer-title"><i class="fas fa-map-marker-alt me-2"></i> Address</h5>
          <p>123 YS Furniture Plaza,</p>
          <p>Asaba, Delta State, Nigeria</p>
        </div>
  
        <div class="col-md-3 col-sm-6 mb-4">
          <h5 class="footer-title"><i class="fas fa-link me-2"></i> Quick Links</h5>
          <ul class="list-unstyled">
            <li><a href="index.html"><i class="fas fa-home me-2"></i> Home</a></li>
            <li><a href="products.html"><i class="fas fa-th me-2"></i> Our Products</a></li>
            <li><a href="about.html"><i class="fas fa-map-marker-alt me-2"></i> Locations</a></li>
            <li><a href="about.html"><i class="fas fa-envelope me-2"></i> Contact</a></li>
          </ul>
        </div>
  
        <div class="col-md-3 col-sm-6 mb-4">
          <h5 class="footer-title"><i class="fas fa-headset me-2"></i> Support</h5>
          <p><i class="fas fa-envelope me-2"></i> info@ysfurniture.com</p>
          <p><i class="fas fa-clock me-2"></i> Mon-Sat: 8AM - 6PM</p>
        </div>
      </div>

      <div class="social-icons mt-3">
        <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="text-white me-2"><i class="fab fa-instagram"></i></a>
        <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
        <a href="#" class="text-white me-2"><i class="fab fa-tiktok"></i></a>
        <a href="#" class="text-white"><i class="fab fa-youtube"></i></a>
      </div>
  
      <hr class="footer-divider">
  
      <div class="text-center mt-3">
        <p>&copy; 2025 <strong>YS Furniture</strong>. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Notification Element -->
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Order submitted successfully! Redirecting to WhatsApp...</span>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Initialize cart from localStorage or empty array
    let cart = JSON.parse(localStorage.getItem('ysfurniture_cart')) || [];

    const products = [
      {id: 1, category:"wine", title:"Classic Wine Shelf", price:"₦1,200,000", discount:"₦1,080,000", img:"https://via.placeholder.com/300x180?text=Wine+Shelf"},
      {id: 2, category:"wine", title:"Premium Wine Cabinet", price:"₦1,500,000", discount:"₦1,350,000", img:"https://via.placeholder.com/300x180?text=Wine+Cabinet"},
      {id: 3, category:"dining", title:"Modern Dining Set", price:"₦1,100,000", discount:"₦990,000", img:"https://via.placeholder.com/300x180?text=Dining+Set"},
      {id: 4, category:"dining", title:"Royal Dining Table", price:"₦2,000,000", discount:"₦1,800,000", img:"https://via.placeholder.com/300x180?text=Royal+Dining"},
      {id: 5, category:"chairs", title:"Luxury Sofa Set", price:"₦950,000", discount:"₦855,000", img:"https://via.placeholder.com/300x180?text=Luxury+Sofa"},
      {id: 6, category:"chairs", title:"Recliner Chair", price:"₦500,000", discount:"₦450,000", img:"https://via.placeholder.com/300x180?text=Recliner"},
      {id: 7, category:"kitchen", title:"Wooden Kitchen Cabinet", price:"₦750,000", discount:"₦675,000", img:"https://via.placeholder.com/300x180?text=Kitchen+Cabinet"},
      {id: 8, category:"kitchen", title:"Luxury Modular Kitchen", price:"₦2,200,000", discount:"₦1,980,000", img:"https://via.placeholder.com/300x180?text=Modular+Kitchen"},
      {id: 9, category:"doors", title:"Steel Security Door", price:"₦600,000", discount:"₦540,000", img:"https://via.placeholder.com/300x180?text=Security+Door"},
      {id: 10, category:"doors", title:"Classic Wooden Door", price:"₦350,000", discount:"₦315,000", img:"https://via.placeholder.com/300x180?text=Wooden+Door"},
      {id: 11, category:"bed", title:"King Size Bed", price:"₦1,300,000", discount:"₦1,170,000", img:"https://via.placeholder.com/300x180?text=King+Bed"},
      {id: 12, category:"bed", title:"Children Bunk Bed", price:"₦500,000", discount:"₦450,000", img:"https://via.placeholder.com/300x180?text=Bunk+Bed"},
      {id: 13, category:"tv", title:"Modern TV Console", price:"₦800,000", discount:"₦720,000", img:"https://via.placeholder.com/300x180?text=TV+Console"},
      {id: 14, category:"tv", title:"Wall Mounted Console", price:"₦650,000", discount:"₦585,000", img:"https://via.placeholder.com/300x180?text=Wall+Console"},
      {id: 15, category:"chairs", title:"Executive Office Chair", price:"₦400,000", discount:"₦360,000", img:"https://via.placeholder.com/300x180?text=Office+Chair"},
      {id: 16, category:"dining", title:"Glass Dining Table", price:"₦1,400,000", discount:"₦1,260,000", img:"https://via.placeholder.com/300x180?text=Glass+Dining"},
      {id: 17, category:"doors", title:"Sliding Glass Door", price:"₦700,000", discount:"₦630,000", img:"https://via.placeholder.com/300x180?text=Glass+Door"},
      {id: 18, category:"wine", title:"Compact Wine Shelf", price:"₦850,000", discount:"₦765,000", img:"https://via.placeholder.com/300x180?text=Compact+Wine"},
      {id: 19, category:"bed", title:"Luxury Bed Frame", price:"₦1,800,000", discount:"₦1,620,000", img:"https://via.placeholder.com/300x180?text=Luxury+Bed"},
      {id: 20, category:"tv", title:"Premium TV Stand", price:"₦900,000", discount:"₦810,000", img:"https://via.placeholder.com/300x180?text=Premium+TV"}
    ];

    // DOM elements
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');

    // Save cart to localStorage
    function saveCartToStorage() {
      localStorage.setItem('ysfurniture_cart', JSON.stringify(cart));
    }

    // Update cart count display
    function updateCartCount() {
      const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
      document.getElementById("cartCount").innerText = totalItems;
    }

    // Show notification function
    function showNotification(message, isError = false) {
      notificationText.textContent = message;
      notification.classList.remove('error');
      
      if (isError) {
        notification.classList.add('error');
      }
      
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 5000);
    }

    // Initialize the page
    window.onload = () => {
      const productContainer = document.getElementById("products");
      products.forEach(p => {
        productContainer.innerHTML += `
          <div class="col-md-4 mb-4 product" data-category="${p.category}">
            <div class="card p-3">
              <img src="${p.img}" alt="${p.title}">
              <h5 class="card-title mt-2">${p.title}</h5>
              <p class="price">${p.price}</p>
              <p class="discount">10% OFF → ${p.discount}</p>
              <button class=" cta-button add-to-cart" data-id="${p.id}"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
            </div>
          </div>`;
      });

      // Update cart count on page load
      updateCartCount();
    };

    // Add to cart
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("add-to-cart")) {
        const productId = parseInt(e.target.dataset.id);
        const product = products.find(p => p.id === productId);
        
        if (product) {
          // Check if item already exists in cart
          const existingItem = cart.find(item => item.id === productId);
          if (existingItem) {
            existingItem.quantity += 1;
          } else {
            cart.push({
              id: product.id,
              title: product.title,
              price: product.discount,
              quantity: 1
            });
          }
          
          // Save to localStorage and update UI
          saveCartToStorage();
          updateCartCount();
          showNotification(`${product.title} added to cart!`);
        }
      }
    });

    // Show cart items
    document.getElementById("cartModal").addEventListener("show.bs.modal", () => {
      const cartItems = document.getElementById("cartItems");
      cartItems.innerHTML = "";
      
      let total = 0;
      cart.forEach(item => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.innerHTML = `
          <span>${item.title}</span>
          <div>
            <button class="btn btn-sm btn-outline-secondary decrease-quantity" data-id="${item.id}">-</button>
            <span class="badge bg-secondary mx-2">${item.quantity}</span>
            <button class="btn btn-sm btn-outline-secondary increase-quantity" data-id="${item.id}">+</button>
            <span class="ms-3">${item.price}</span>
          </div>`;
        cartItems.appendChild(li);
        
        // Calculate total
        const price = parseFloat(item.price.replace(/[^\d.]/g, ''));
        total += price * item.quantity;
      });
      
      // Format total as Nigerian Naira
      document.getElementById("cartTotal").textContent = `₦${total.toLocaleString()}`;
    });

    // Handle quantity changes in cart
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("increase-quantity")) {
        const productId = parseInt(e.target.dataset.id);
        const item = cart.find(item => item.id === productId);
        if (item) {
          item.quantity += 1;
          saveCartToStorage();
          // Refresh cart modal
          bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
          setTimeout(() => {
            document.getElementById('cartModal').click();
          }, 100);
        }
      }
      
      if (e.target.classList.contains("decrease-quantity")) {
        const productId = parseInt(e.target.dataset.id);
        const itemIndex = cart.findIndex(item => item.id === productId);
        if (itemIndex !== -1) {
          if (cart[itemIndex].quantity > 1) {
            cart[itemIndex].quantity -= 1;
          } else {
            cart.splice(itemIndex, 1);
          }
          saveCartToStorage();
          updateCartCount();
          // Refresh cart modal
          bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
          setTimeout(() => {
            document.getElementById('cartModal').click();
          }, 100);
        }
      }
    });

    // Clear cart button
    document.getElementById("clearCartBtn").addEventListener("click", () => {
      if (cart.length > 0) {
        if (confirm("Are you sure you want to clear your cart?")) {
          cart = [];
          saveCartToStorage();
          updateCartCount();
          showNotification("Cart cleared successfully!");
        }
      } else {
        showNotification("Your cart is already empty!", true);
      }
    });

    // Category filter
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("filter-btn")) {
        const category = e.target.dataset.category;
        document.querySelectorAll(".product").forEach(product => {
          product.style.display = (category === "all" || product.dataset.category === category) ? "block" : "none";
        });
      }
    });

    // Fetch WhatsApp number from backend
    async function fetchWhatsAppNumber() {
      try {
        // For mobile compatibility, try multiple endpoints
        const endpoints = [
          "http://127.0.0.1:5000/get_whatsapp",
          "http://localhost:5000/get_whatsapp"
        ];
        
        let response = null;
        for (const endpoint of endpoints) {
          try {
            response = await fetch(endpoint);
            if (response.ok) break;
          } catch (e) {
            console.log(`Failed to fetch from ${endpoint}`, e);
          }
        }
        
        if (!response || !response.ok) {
          throw new Error(`Server returned ${response?.status}: ${response?.statusText}`);
        }
        
        const data = await response.json();
        return data.whatsapp;
      } catch (error) {
        console.error("Error fetching WhatsApp number:", error);
        // Fallback number
        return "2347026972403";
      }
    }

    // Submit order via WhatsApp
    async function submitOrder(event) {
      event.preventDefault();
      
      // Collect customer details
      let name = document.getElementById("fullName").value;
      let phone = document.getElementById("phone").value;
      let address = document.getElementById("address").value;

      // Validate form
      if (!name || !phone || !address) {
        showNotification("Please fill in all fields before submitting your order.", true);
        return;
      }

      if (cart.length === 0) {
        showNotification("Your cart is empty. Please add items to your cart before submitting.", true);
        return;
      }

      try {
        const whatsappNumber = await fetchWhatsAppNumber();

        // Build cart details
        let cartDetails = cart.map(item => 
          `- ${item.quantity} x ${item.title} (${item.price})`
        ).join("%0A");

        // Calculate total
        let total = 0;
        cart.forEach(item => {
          const price = parseFloat(item.price.replace(/[^\d.]/g, ''));
          total += price * item.quantity;
        });

        // Create message
        let message = `Hello, my name is ${name}.%0AMy phone is ${phone}.%0AMy address is: ${address}.%0A%0AI want to order:%0A${cartDetails}%0A%0ATotal: ₦${total.toLocaleString()}`;

        // Show success notification
        showNotification("Order submitted successfully! Redirecting to WhatsApp...");
        
        // Mobile devices sometimes have issues with window.open, so we try multiple approaches
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        if (isMobile) {
          // For mobile devices, use a direct link that might work better
          setTimeout(() => {
            window.location.href = `https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${message}`;
          }, 1000);
        } else {
          // For desktop, use standard approach
          setTimeout(() => {
            window.open(`https://web.whatsapp.com/send?phone=${whatsappNumber}&text=${message}`, "_blank");
          }, 1000);
        }
        
        // Clear cart after successful order
        cart = [];
        saveCartToStorage();
        updateCartCount();
        
      } catch (error) {
        console.error("Error submitting order:", error);
        showNotification(`Error: ${error.message}. Please try the manual option.`, true);
      }
    }

    // Add event listener to form
    document.getElementById("orderForm").addEventListener("submit", submitOrder);

    // Copy button functionality
    document.getElementById("copyButton").addEventListener("click", () => {
      const tempTextArea = document.createElement('textarea');
      tempTextArea.value = document.getElementById("manualWhatsappNumber").value;
      document.body.appendChild(tempTextArea);
      tempTextArea.select();
      document.execCommand('copy');
      document.body.removeChild(tempTextArea);
      
      showNotification("WhatsApp number copied to clipboard!");
    });

    // Initialize WhatsApp number
    document.addEventListener('DOMContentLoaded', async () => {
      const number = await fetchWhatsAppNumber();
      document.getElementById("manualWhatsappNumber").value = number;
    });
  </script>
</body>
</html>